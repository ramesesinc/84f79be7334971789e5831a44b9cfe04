import com.rameses.annotations.*;

class CloudPartnerService {

    @DataContext("gdx_partner")
    def partner;		
   
    @DataContext("barangay")
    def barangayEm; 
   
    @ProxyMethod
    public def getList() {
        def list = partner.getList(); 
		return resolveList( list );
    } 

    // updated
    @ProxyMethod
    public def getActivePartners() {
        def list = getList().findAll{( it.state.toString().equalsIgnoreCase('ACTIVE') )} 
        return resolveList( list );
    } 


    @ProxyMethod
    public def getActiveList() {
		def list = partner.orderBy("group.name").where(" state='ACTIVE' ").list();
        return resolveList( list );
    }		

    @ProxyMethod
    public def getInactiveList() {
		def list = partner.orderBy("group.name").where(" state='INACTIVE' ").list();
        return resolveList( list );
    }		

 	@ProxyMethod
    public def findByGroupAndName(params) {
		def list = partner.find( ["group.name": params.groupname, "name": params.name ] ).first();
        return resolveList( list );
    }		

    @ProxyMethod
    public def findByCode(params) {
        def list = partner.find( ["group.name": params.groupname, "name": params.name ] ).first();
        return resolveList( list );
    }   	

    @ProxyMethod
    public def findById(params) {
        def list = partner.find( [id: params.id ] ).first();
        return resolveList( list );
    }           

    @ProxyMethod
    public def getBarangayList( def param ) {
        return barangayEm.find([parentid: param.orgcode]).select("objid,name").orderBy("name").list(); 
    } 


    def resolveList( list ) {
        list.each{ o-> 
            o.channelid = [o.id, o.clientid].findAll{( it )}.join(':'); 
        }
        return list; 
    }
}